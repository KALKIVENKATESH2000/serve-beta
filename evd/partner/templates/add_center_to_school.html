{% extends "base.html" %}
{% load tags %}

{% block head_scripts %}
    {{ block.super }}

    <script src='/static/js_new/parsley.min.js' type='text/javascript' ></script>

{% endblock %}

{% block head_styles %}
{{ block.super }}
    <style>
         <!--.classInputInline{-->
            <!--display: inline !important;-->
            <!--margin-bottom:unset;-->
         <!--}-->
         .submitForm {
            margin : 16px 5px;
         }
         label {
            min-width: 39% !important;
            text-align:center;
         }
         .divrow{
            margin-bottom:20px;
         }
         .errorlist {
            color: red;
            padding-left: 42%;
            padding-top: 2%;
         }

</style>
{% endblock %}

{% block body_container %}
    {{ block.super }}

<div class="col-sm-12 col-md-12 col-lg-12"  style="background-color:#fff">
    <div class="col-sm-12 col-md-12 col-lg-12"><h3 id="addUpdateHeading">{% if update_flag %}Update{% else %}Add{% endif %} Center</h3><hr/></div>
    <div class="col-lg-12 col-md-12 col-sm-12">
        {% if errormsg %}
            <div class="alert alert-danger">
                <strong>Info!</strong> {{ errormsg }}
            </div>
        {% endif %}
        <form id="add_center_form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row divrow">
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.name.label_tag }}   {{ center_form.name }}<span style="color:red">*</span>
                    {{ center_form.name.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.language.label_tag }}  {{ center_form.language }}<span style="color:red">*</span>
                    {{ center_form.language.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.board.label_tag }}   {{ center_form.board }}<span style="color:red">*</span>
                    {{ center_form.board.errors }}
                </div>
            </div>
            <div class="row divrow">
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.working_days.label_tag }}   {{ center_form.working_days }}
                    {{ center_form.working_days.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.working_slots.label_tag }}  {{ center_form.working_slots }}
                    {{ center_form.working_slots.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.status.label_tag }}   {{ center_form.status }}
                    {{ center_form.status.errors }}
                </div>
            </div>
            <div class="row divrow">
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.admin.label_tag }}   {{ center_form.admin }} {{ center_form.selected_admin }}
                    {{ center_form.admin.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.assistant.label_tag }}   {{ center_form.assistant }} {{ center_form.selected_assistant }}
                    {{ center_form.assistant.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.photo.label_tag }}  {{ center_form.photo }}
                    {{ center_form.photo.errors }}
                </div>
            </div>
            <div class="row divrow">
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.field_coordinator.label_tag }}   {{ center_form.field_coordinator }} {{ center_form.selected_field_coordinator }}
                    {{ center_form.field_coordinator.errors }}
                </div>
                <div class="fieldWrapper col-md-4 col-sm-4">
                    {{ center_form.delivery_coordinator.label_tag }}   {{ center_form.delivery_coordinator }} {{ center_form.selected_delivery_coordinator }}
                    {{ center_form.delivery_coordinator.errors }}
                </div>
                <div class="fieldWrapper col-md-4 col-sm-4">
                    {{ center_form.hm.label_tag }}   {{ center_form.hm }}
                    {{ center_form.hm.errors }}
                </div>
            </div>
            <div class="row divrow">
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.funding_partner.label_tag }}   {{ center_form.funding_partner }}
                    {{ center_form.funding_partner.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.delivery_partner.label_tag }}  {{ center_form.delivery_partner }}<span style="color:red">*</span>
                    {{ center_form.delivery_partner.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.partner_school.label_tag }}   {{ center_form.partner_school }}<span style="color:red">*</span>
                    {{ center_form.partner_school.errors }}
                </div>
            </div>
            <div class="row divrow">
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.classlocation.label_tag }} {{ center_form.classlocation }}
                    {{ center_form.classlocation.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.grades.label_tag }}   {{ center_form.grades }}
                    {{ center_form.grades.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.subjectscovered.label_tag }}   {{ center_form.subjectscovered }}
                    {{ center_form.subjectscovered.errors }}
                </div>
            </div>
            <div class="row divrow">
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.noofchildren.label_tag }}   {{ center_form.noofchildren }}
                    {{ center_form.noofchildren.errors }}
                </div>
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.launchdate.label_tag }}   {{ center_form.launchdate }}
                    {{ center_form.launchdate.errors }}
                </div>
                <div class="fieldWrapper col-md-4 col-sm-4">
                    {{ center_form.skype_id.label_tag }}   {{ center_form.skype_id }}
                    {{ center_form.skype_id.errors }}
                </div>
            </div>
            <div class="row divrow">
                <!-- <div class="fieldWrapper col-md-4 col-sm-4">
                    <div style="margin-bottom:20px;">
                    {{ center_form.donor_name.label_tag }}   {{ center_form.donor_name }}
                    {{ center_form.donor_name.errors }}
                    </div>
                    <div>
                    {{ center_form.ops_donor_name.label_tag }}  {{ center_form.ops_donor_name }}
                    {{ center_form.ops_donor_name.errors }}
                    </div>
                </div> -->
                {% if is_deliver_partner and update_flag %}
                <div style = "pointer-events: none;" class="fieldWrapper col-md-4 col-sm-4">
                {% else %}
                <div class="fieldWrapper col-md-4 col-sm-4">
                {% endif %}
                    {{ center_form.orgunit_partner.label_tag }}   {{ center_form.orgunit_partner }}
                    {{ center_form.orgunit_partner.errors }}
                </div>
                <div class="fieldWrapper col-md-4 col-sm-4">
                    {{ center_form.location_map.label_tag }}  {{ center_form.location_map }}
                    {{ center_form.location_map.errors }}
                </div>
                <div class="fieldWrapper col-md-4 col-sm-4">
                    {{ center_form.description.label_tag }} {{ center_form.description }}<span style="color:red">*</span>
                    {{ center_form.description.errors }}
                </div>
                <div class="fieldWrapper col-md-4 col-sm-4"></div>
            </div>
            <div class="row divrow">
                <div class="fieldWrapper col-md-4 col-sm-4">
                    <div style="margin-bottom:20px;">
                    {{ center_form.program_type.label_tag }}   {{ center_form.program_type }}
                    {{ center_form.program_type.errors }}
                    </div>
                </div>
                
                <div class="fieldWrapper col-md-4 col-sm-4"></div>
            </div>
            <div class="row divrow">
                <div class="fieldWrapper col-md-offset-6 col-sm-offset-6 col-md-4 col-sm-4">
                    <button class="submitForm btn btn-success" type="submit" id="id_addCenter" onclick="waitJustLoading()">{% if update_flag %}Update{% else %}Save{% endif %}</button>
                </div>
            </div>
        </form>
    </div>
    <!--{{ center_form }}-->

</div>


{% endblock %}

{% block bottom_scripts %}
    {{ block.super }}
    <script type='text/javascript' src='/static/js/calendar/fullcalendar.js'></script>
    <script type="text/javascript">
        $(document).ready(function(){
	        $(".inner.clearfix").css("width","85%");
	        $('#id_launchdate').prop('type', 'date');
             
            if(document.getElementById("addUpdateHeading").innerHTML=="Update Center"){
                $(".disableDrop").attr('disabled','disabled')
            }

            let url = window.location.href;
            let is_school_admin = '{{is_school_admin}}'
            if(is_school_admin == 'True'){
                school_id = '{{school_id}}'
                school_name = '{{school_name}}'
                partner_name = '{{school_data.partner.name}}'
                partner_id = '{{school_data.partner.id}}'
                if(url.includes('addcenter') && school_id && school_name){
                    $('#id_partner_school option[value=\"' + school_id + '\"]').prop('selected', true);
                    $('#id_partner_school').attr('disabled', true);
                    $('#id_delivery_partner option[value=' + partner_id + ']').prop('selected', true);
                    $('#id_delivery_partner').attr('disabled', true)
                } else {
                    $('#id_partner_school option[value=\"' + school_id + '\"]').prop('selected', true)
                    $('#id_partner_school').attr('disabled', true)
                    $('#id_delivery_partner option[value=' + partner_id + ']').prop('selected', true);
                    $('#id_delivery_partner').attr('disabled', true)
                }
             }

        });

        function waitJustLoading() {
		    var control=document.getElementById('id_addCenter');
			control.disabled=true;
			var btn_text = control.innerHTML
			control.innerHTML='<i class="fa fa-spinner fa-spin" style="font-size:100px; color:#232222;"></i>';
			var name = $("#id_name").val(),
			    delivery_partner = $("#id_delivery_partner").val(),
			    partner_school = $("#id_partner_school").val(),
			    description = $("#id_description").val();
			if(name == '' || delivery_partner == '' || partner_school == '' || description == ''){
			    if(name == '') $("#id_name").prop('required',true);
			    if(delivery_partner == '') $("#id_delivery_partner").prop('required',true);
			    if(partner_school == '') $("#id_partner_school").prop('required',true);
			    if(description == '') $("#id_description").prop('required',true);
			    control.disabled=false;
			    control.innerHTML = btn_text;
			    return false;
			}
            $('#id_partner_school').attr('disabled', false)
            $('#id_delivery_partner').attr('disabled', false)
			$('form#add_center_form').submit();
		}

    </script>

    <script>
        var admin_autocomplete_data = {
        source : "/partner/ajax/get_my_users",
        minLength : 1,
        autoFocus : true,
        select : function(event, ui) {
               $(this).val(ui.item.value);
               $('#id_selected_admin').val(ui.item.id);
         },
       change : function(event, ui) {
             if (ui.item) {
                    return;
             }
             else {
                $(this).val('');
                $('#id_selected_admin').val('');
             }
          }
    }

    $('#id_admin').click(function(){

        $(this).autocomplete(admin_autocomplete_data)
     });
    </script>

    <script>
        var assistant_autocomplete_data = {
        source : "/partner/ajax/get_my_users",
        minLength : 1,
        autoFocus : true,
        select : function(event, ui) {
               $(this).val(ui.item.value);
               $('#id_selected_assistant').val(ui.item.id);
         },
       change : function(event, ui) {
             if (ui.item) {
                    return;
             }
             else {
                $(this).val('');
                $('#id_selected_assistant').val('');
             }
          }
    }

    $('#id_assistant').click(function(){

        $(this).autocomplete(assistant_autocomplete_data)
     });
    </script>

    <script>
        var field_coordinator_autocomplete_data = {
        source : "/partner/ajax/get_my_users",
        minLength : 1,
        autoFocus : true,
        select : function(event, ui) {
               $(this).val(ui.item.value);
               $('#id_selected_field_coordinator').val(ui.item.id);
         },
       change : function(event, ui) {
             if (ui.item) {
                    return;
             }
             else {
                $(this).val('');
                $('#id_selected_field_coordinator').val('');
             }
          }
    }

    $('#id_field_coordinator').click(function(){

        $(this).autocomplete(field_coordinator_autocomplete_data)
     });
    </script>

    <script>
        var delivery_coordinator_autocomplete_data = {
        source : "/partner/ajax/get_my_users",
        minLength : 1,
        autoFocus : true,
        select : function(event, ui) {
               $(this).val(ui.item.value);
               $('#id_selected_delivery_coordinator').val(ui.item.id);
         },
       change : function(event, ui) {
             if (ui.item) {
                    return;
             }
             else {
                $(this).val('');
                $('#id_selected_delivery_coordinator').val('');
             }
          }
    }

    $('#id_delivery_coordinator').click(function(){

        $(this).autocomplete(delivery_coordinator_autocomplete_data)
     });
    </script>
{% endblock %}