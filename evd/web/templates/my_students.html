<html>
<head>
<link rel="stylesheet" type="text/css" href="/static/css/mystud.css" />
<style>
.container-fluid{
/*background-image: url('/static/images/chalk.PNG');*/
    background-repeat: no-repeat;
    background-size:100% 100%;
    background-attachment: fixed;
    background-position: center;
    padding-left:0px;
    padding-right:0px;
}


.active_stud{
   background-color : #FF7043;

}
.stickerActive{
                  -webkit-filter: drop-shadow(8px 8px 10px green);
                  filter: drop-shadow(8px 8px 10px green);
                   transform: scale(1.3);
                  }

.sticker:hover{
                  -webkit-filter: drop-shadow(8px 8px 10px green);
                  filter: drop-shadow(8px 8px 10px green);
                  transform: scale(1.3);
                  
                  }
</style>

<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="/static/js/underscore-min.js"></script>
<script src="/static/js/student-module.js"></script>

<link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/student-module.css">
<link href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
<!-- <script>
$(document).ready(function(){

    $(window.parent.document).find('html').css({ overflow: 'hidden' });
    $( window ).unload(function() { $(window.parent.document).find('html').css({ overflow: '' })});


   $.post('/get_off_stud/',{'center_id': parent.window.center_id }, function(resp){
   console.time('ConcatTimer');
   $('#student_details').hide();
   $('#loader').show();
   console.log(resp);
   //processing response
         var offer_html = "";
         var stud_html = "";
         resp1 =  resp;
         var t1 = _.template(" <%  _.forEach(resp1.offerings, function(u){  %> " +
                         "   <div class='offer_stud' id='offer_<%= u.offer_id%>' style='display:none;'> "+
                         "   <% _.forEach(u.offer_en_stud, function(uu){  %>  "+
                         "    <div class='stud_details_block' id='stud_<%= uu.stud_id %>' style='display:none;'> "+
                         "      <div class='row' >  "+
                         "          <div class='col-sm-2' style='padding-top:10px;' > "+
                         "             <img class='img-responsive img-thumbnail img-circle' style='max-height:100px;'   src='/<%= uu.stud_photo %>'  />  "+
                         "          </div>  "+
                         "      <div class='col-sm-5' style='padding-top:10px;'>  "+
                         "             <label>Name :</label><p style='display:inline;padding-left:10px;'> <%= uu.stud_name %> </p><br> "+
                         "              <label>Dob :</label><p style='display:inline;'> <%= uu.stud_dob %></p><br> "+
                         "              <label>Grade :</label><p style='display:inline'> <%= uu.stud_grade %>  </p><br> "+
                         "              <label>Gender :</label><p style='display:inline'> <%= uu.stud_gender %></p><br> "+
                         "       </div> "+
                         "       <div class='col-sm-5' style='padding-top:10px;'> "+
                         "              <label>center :</label><p style='display:inline'> WIll be updated</p><br> "+
                         "              <label>School RollNo :</label><p style='display:inline'> <%= uu.stud_sch_rollno %></p><br> "+
                         "              <label>Father Occupation :</label><p style='display:inline;padding-left:10px;'> <%= uu.stud_fath_occ %></p><br> "+
                         "              <label>Mother Occupation :</label><p style='display:inline;'> <%= uu.stud_moth_occ %>  </p><br> "+
                         "       </div> "+
                         "       </div> "+
                         "      <div class='row sectns' style='padding-top:20px;'> "+
                         "         <div class=' col-sm-12' > "+
                         "             <ul class='nav nav-tabs' data-offer='<%= u.offer_id %>' data-id='<%= uu.stud_id %>' > "+
                         "                 <li role='presentation' class='active'><a  class='stud_att'  id='att_<%=uu.stud_id %>_<%=u.offer_id%>'>Attendance</a></li> "+
                         "                 <li role='presentation'><a  class='stud_schol'  >Scholastic</a></li> "+
                         "                 <li role='presentation'><a  class='stud_coschol'  >Co-Scholastic</a></li> "+
                         "                 <li role='presentation'><a  class='stud_act'  >Activities</a></li> "+
                         "                 <li role='presentation'><a  class='stud_uc'>Unique Characterstics</a></li> "+
                         "                 <li role='presentation'><a  class='stud_diag' >Diagnostics</a></li> "+
                         "             </ul> "+
                         "         </div> "+
                         "      </div> "+
                         "      <div class='row' >"+
                         "          <div class='col-sm-offset-1 col-sm-10 col-sm-offset-1 lr_tables' style='padding-top:30px;overflow-y:auto;height:410px;margin-bottom:10px;' id='lr_<%= uu.stud_id %>'>"+
                         "            <table class='table table-striped table-hover'>"+
                         "            </table>"+
                         "          </div>"+
                         "      </div>"+
                         "      <div class='row actions' style='text-align:center;' >"+
                         "            <div class='btn btn-primary edit' style='width:100px;'>Edit</div>  "+
                         "            <div class='btn btn-primary cancel' style='display:none;'>Cancel</div>  "+
                         "            <div class='btn btn-success submit' style='display:none;'>Submit</div>  "+
                         "      </div>  "+
                         "     </div> "+
                         "    <% }) %> </div>"+
                         "    <% }) %>  " );
       t1( resp1.offerings );
       console.log(t1);

       var offer_stud_html = "";
         resp.offerings.forEach(function(){
             var curr =  arguments[0];
             console.log(curr);
             stud_html = "";
             offer_html += '<option value='+curr.offer_id+' >'+curr.offer_name+'</option> ';
             curr.offer_en_stud.forEach(function(){ var curr1=arguments[0];  stud_html += '<li class="list-group-item stud_ent" style="cursor:pointer" data-offer='+ curr.offer_id +' data-id='+ curr1.stud_id +' > '+ curr1.stud_name +'</li>'  });
             offer_stud_html +='  <ul class="list-group stud_lists"  data-len="'+curr.offer_en_stud.length +'" id="students_list_'+curr.offer_id +'"  style="display:none;max-height:540px;overflow-y:scroll;"> '+ stud_html +' </ul> ';
         });

  $('#student_details').html(t1);
   $('#sel_offer').html(offer_html);
   $('#sel_offer').change(function(){ var tmp="#students_list_"+$(this).val();  $('.stud_lists').hide();  $(tmp).slideDown().find('.stud_ent').first().css({'background-color':'#D64541', 'color':'white'}); $('#stud_badge').text($(tmp).data('len'));});
   $('#off_badge').text(resp.offer_count);
   $('#students_list').html(stud_html);
   $('#students').html(offer_stud_html);
   $('#stud_badge').text($('.stud_lists').first().data('len'));
   $('#students').find('.stud_lists').first().show().find('.stud_ent').first().css({'background-color':'#D64541', 'color':'white'});
   // Caching responses

   var resp_dict =  {};
   var template_dict = {};

   function render_resp(resp, temp_dict, stud_id, offer_id){
      var stu_id = stud_id;
      var off_id = offer_id;
      var ky = stu_id+ '_' + off_id;
      if(_.has(temp_dict,ky)){
          temp = temp_dict.ky;
          return temp;
      }else{
          templt = _.template(     );

      }

   }


   // Report Fetch
   $('a.stud_schol').click(function(){   
      $(this).parent('li').siblings().removeClass('active');
      $(this).parent('li').addClass('active');
      $('.actions').show();
      var that= $(this);
      var temp = that.parent().parent();
      var stud_id = temp.data('id');
      var offer_id =  temp.data('offer');
      var kyy = stud_id+'_'+offer_id;
      $.post('/get_scholastic/',{ 'stud_id':stud_id,'offer_id':offer_id  },function(resp){
        console.log(resp);
        var  par = "#stud_" + stud_id;
        var curr_tab = "#lr_"+ stud_id;
        resp2 = resp;
        var  scol_temp = _.template("<tbody> <tr><th>Subject</th><th>Total</th><th>Actual</th><th>Assessed By</th><th>Date</th></tr> <% _.forEach(resp2.scholastic, function(u){ %> <tr data-id='<%=u.id%>'> <td> <%= u.subject %> </td><td> <%= u.total %> </td><td> <%= u.actual  %>  </td><td> <%= u.assessed_by %> </td><td> <%= u.date  %> </td></tr></tbody> <%  }); %> "  );
        scol_temp(resp2.scholastic);
        console.log(scol_temp);
        that.parentsUntil('.row').last().parent().next().find('.lr_tables').find('table').html(scol_temp);
      });
   });
   $('a.stud_att,a.stud_uc,a.stud_diag,a.stud_act').click(  function(){
      $(this).parent('li').siblings().removeClass('active');
      $(this).parent('li').addClass('active');
      $('.actions').hide();
      var that= $(this);
      var temp = that.parent().parent();
      var stud_id = temp.data('id');
      var offer_id =  temp.data('offer');
      var kyy = stud_id+'_'+offer_id;
                if( _.has(resp_dict,kyy)){
                $.post('/get_stud_report/',{ 'stud_id': stud_id, 'offer_id': offer_id }, function(resp){
                         resp_dict[kyy] = resp;
                         console.log(resp);
                         console.log(resp_dict);
                         //This will go to render response function
                         var  par = "#stud_" + stud_id;
                         var pre = resp.absent;
                         var abs  = resp.present;
                         var curr_tab = "#lr_"+ stud_id;
                         var content ="<tr><th>Sl.No</th> <th> Present </th> <th>Absent</th></tr> <tr> <td> 1 </td> <td> "+ pre +" </td> <td> "+ abs +" </td>   </tr>";
                         that.parentsUntil('.row').last().parent().next().find('.lr_tables').find('table').html(content);
               });
                 
                }
                else{
                $.post('/get_stud_report/',{ 'stud_id': stud_id, 'offer_id': offer_id }, function(resp){
                         resp_dict[kyy] = resp;
                         console.log(resp);
                         console.log(resp_dict);
                         //This will go to render response function
                         var  par = "#stud_" + stud_id;
                         var pre = resp.absent;
                         var abs  = resp.present;
                         var curr_tab = "#lr_"+ stud_id;
                         var content ="<tr><th>Sl.No</th> <th> Present </th> <th>Absent</th></tr> <tr> <td> 1 </td> <td> "+ pre +" </td> <td> "+ abs +" </td>   </tr>";
                         that.parentsUntil('.row').last().parent().next().find('.lr_tables').find('table').html(content);
               });
               }

    });// stud_attend end click


   $('.edit').on('click', function(){ 
           var that = $(this).parent().prev().find('td');
           $(this).hide().next().next().show();
           that.each(function(){ 
           var orig_content = $(this).text();
           var width=$(this).css('width');
           $(this).html("<input type='text' style='width:100px;' value='"+ orig_content +"'/>");
           });
           $(this).next().show();
  });
  $('.cancel').on('click',function(){  
           console.log('cancel');
           $(this).hide();
           var that = $(this).parent().prev().find('td');
           console.log(that);
           that.each(function(){
               var orig_content = $(this).find('input').val();
               console.log(orig_content);
               $(this).html(orig_content);
           });
           $(this).prev().show();
           $(this).next().hide();
   });
  $('.submit').on('click', function(){
           var that= $(this).parent().prev().find('table').find('tr').not(':eq(0)');
           var that1 = $(this)
            console.log(that);
           var up_list = []
           that.each(function(){
                     var rec = {}
                     rec['id']=$(this).data('id');
                     tds = $(this).find('td');
                     rec['subject']
                     var rec ={ 'id':$(this).data('id'), 'subject':$(tds[0]).find('input').val(), 'total':$(tds[1]).find('input').val(), 'actual':$(tds[2]).find('input').val() };
                     console.log(rec);
                     up_list.push(rec)
                 });
            $.post('/update_lrs/', {'up_list': JSON.stringify(up_list) },function(resp){ that1.text('Please Wait...'); that1.prev().hide();that1.prev().prev().show(); $(that1).parent().prevUntil('sectns').find('a.stud_schol').click();  }).done(function(){that1.text('Submit').hide();alert('Updated Successfully');});
  });

   $('#students').find('.stud_ent').click(function(){
         var ele = $(this);
         ele.parent().find('.stud_ent').css({'background-color':'', 'color':'black'});
         ele.css({'background-color':'#D64541', 'color':'white'}).addClass("active_stud");
         var ofr = '#offer_'+ele.data('offer');
         var stu_id = '#stud_'+ele.data('id');
         $('.offer_stud').hide();
         $(ofr).slideDown().find('.stud_details_block').hide();
         $(ofr).find(stu_id).slideDown();
   });
   }).done(function(){$('#student_details').show(); $('#loader').hide();});

});// end document ready
</script>-->


</head>
<body style="background-color:white; ">
<input type="hidden" id ="hidden_tab_id" value={{tab_id}}>
<!--<input type="hidden" id ="hidden_appreciation_id" value={{appreciation_reasons}}>-->

<div class="container-fluid" style=" height:720px;">
    <div class="row" style="background-color:#27ae60;padding:10px;" > <!-- Row 1 -->
        <!-- <a class="clos"
        style="padding-left: 1015px; font-size: 25px; margin-top: 100px;"><span
        id="menuClose" class="glyphicon glyphicon-remove-circle"
        style="background-color: #5ba75c; color: black;"></span></a>
        <div class="col-sm-offset-5 col-sm-2" style="color:white;text-align:center;font-weight:bold;">My Students </div> -->
    <span class="col-sm" style="color:white;text-align:center;font-weight:bold; padding-left: 430px">My Students</span>
    <a class="clos" style="padding-left: 490px; font-size: 25px; margin-top: 100px;"><span id="menuClose" class="glyphicon glyphicon-remove-circle" style="background-color: #5ba75c; color: black;"></span></a>                   
                
    </div> <!-- end row 1 -->
    <div class="row" ><!--Row 2 -->
        <div class="col-sm-3" style="height:652px;background-color:#A5C57F; " >
           <h5  style="color:white;" >Academic Year </h5>
           <div id ="ay" class="ay">
               <select id="sel_ay" class="form-control" style="margin-top:5px;width:100%;">
                   <option value="">Academic Year</option>
                   <option value="6th maths">AY 16-17 NCERT</option>
               </select>
           </div>

           <h5  style="color:white;" >Offerings  <span id="off_badge" class="badge">0</span></h5>
           <div id ="offer" class="offer">
               <select id="sel_offer" class="form-control" style="margin-top:5px;width:100%;">
                  <option value="">Offering</option>
                  <option value="6th maths">6th maths</option>
               </select>
           </div>

           <h5 style="color:white;" >Students <span id="stud_badge" class="badge">0</span></h5>
           <div id="students" style="max-height:540px;" >
           </div>

        </div> <!--end row 2 -->

           <div class="row" id="loader" style="">
               <div class="col-sm-offset-3 col-sm-4" style="height:600px;padding-top:234px;">
               <img src="/static/images/stud_search.GIF" width="100" height="100" align="left">'
                </div>
           </div>

           <div class='modal' id='studentAssignmentModal' role='dialog' style='width: 55%;height:60%;margin-left:35%;margin-top:20%;border-radius: 10px;'>
                <div class='modal-header' style='background-color: #f15a22;height: 55px;'>
                    <p style='text-align: left;font-size: 16px;font-weight: bold; font-family: PlutoCondRegular;color:#FFFFFF;'>Update Assignment Status<button type='button' class='close' style='float: right; background-color: white;' onclick="closeModal('studentAssignmentModal');">&times;</button></p>
                </div>
                <div class='modal-body' id='student_assignment_modal' style="background-color: white; border:1px solid #f15a22; border-top: 0px;border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;">
                </div>
                <!-- <div class='modal-footer' id='student_assignment_modal_footer' style="background-color: white;"></div> -->
            </div>


        <div class="col-sm-9"  id ="student_details" style="height:700px;display:none; background-color:white;" >

            <div class="row">
                <div class="col-sm-2" style="padding-top:10px;" >
                   <img class="img-responsive img-thumbnail" style="max-height:130px;"   src="/static/images/Ravi.jpg"  />
                </div>
                <div class="col-sm-5" style="padding-top:10px;">
                   <label>Name :</label><p style="display:inline;padding-left:10px;">praneeth</p><br>
                   <label>Dob :</label><p style="display:inline;">04-09-1991</p><br>
                   <label>Grade :</label><p style="display:inline">6th</p><br>
                   <label>Gender :</label><p style="display:inline">Male</p><br>
                </div>

                <div class="col-sm-5" style="padding-top:10px;">
                   <label>center :</label><p style="display:inline">Koyritola - Hira</p><br>
                   <label>School RollNo :</label><p style="display:inline">563</p><br>
                   <label>Father's Occupation :</label><p style="display:inline;padding-left:10px;">Employee</p><br>
                   <label>Mother's Occupation :</label><p style="display:inline;">Employee</p><br>
                </div>

            </div>

           <div class="row" style="padding-top:20px;" >
              <div class="col-sm-offset-1 col-sm-10">
                  <ul class="nav nav-tabs" >
                      <li role="presentation" class="active"><a href="#">Attendance</a></li>
                      <li role="presentation"><a href="#">Scholastic</a></li>
                      <li role="presentation"><a href="#">Co-Scholastic</a></li>
                      <li role="presentation"><a href="#">Activities</a></li>
                      <li role="presentation"><a href="#">Unique Characterstics</a></li>
                      <li role="presentation"><a href="#">Unique Characterstics</a></li>

                  </ul>
              <div>

           </div>


        </div>
    </div>

</div>

<script >
$("#menuClose").click(function(){
	
	$(".clos").click(function() {
		parent.$.fn.colorbox.close()
	});
});


</script>
</body></html>
