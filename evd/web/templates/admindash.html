{% extends "base.html" %}
{% load tags %}
{% load filters %}
{% block head_title %}eVidyaloka - Admin dashboard{% endblock %}

{% block doc_ready %}
    evd.after_save = function(){
            $(this).hide();
        }
   window.evd.pre_add_course = function(){
                    $("#add-course-modal select").each(function(){
                        if($(this).children(":selected").val() == ""){
                            $(this).attr({"rel":"tooltip", "data-placement":"right", "title":"select any one of these"}).tooltip("show");
                            return false;
                        }
                    });

                    var planned_topics = "",
                        enroll_students = "",
                        topics_len =  $("select#planned_topics").children(":selected").length,
                        students_len = $("select#enroll_students").children(":selected").length;
                    $("select#planned_topics").children(":selected").each(function(index, val){
                        planned_topics += $(this).val() + (index < (topics_len - 1) ? ";" : "");
                    });
                    $("input[name='planned_topics']").val(planned_topics);
                    $("select#enroll_students").children(":selected").each(function(index, val){
                        enroll_students += $(this).val() + (index < (students_len - 1) ? ";" : "");
                    });
                    $("input[name='students']").val(enroll_students);
                }
                window.evd.after_add_course = function(){
                    $("#add-course-modal").modal("hide");
                    evd.show_msg("Added course successfully")
                }

    evd.assign_center = function(resp){
        var $center = $(".sel_center_class"),
        	$center_text = $("#sel_center_id").val(),
            $admin = $(".sel_admin_class_val"),
            $admin_text = $(".sel_admin_class").val(),
            $assistant = $(".sel_assistant_class_val"),
            $assistant_text = $(".sel_assistant_class").val(),
            $field_coordinatator = $(".sel_fcd_class_val"),
            $field_coordinatator_text = $(".sel_fcd_class").val(),
            $delivery_coordinator = $(".sel_dc_class_val"),
            $delivery_coordinator_text = $(".sel_dc_class").val(),
            $partner = $(".sel_partner_class_val"),
            $partner_text = $(".sel_partner_class").val(),
            $orgpartner = $(".sel_orgpartner_class_val"),
            $orgpartner_text = $(".sel_orgpartner_class").val(),
            removed_center_admin_value = "";
        if(resp == "added" || resp =="Both-added"){
            $center.removeClass("no-admin");
            $admin.removeClass("no-assigned").css({"color":"#333"});
            evd.show_msg($center_text +" is assigned succesfully to "+ $admin_text);
            $("#adminId").css('display','block');
            $("#adminId").attr({"href": "/assign_center?flag=Admin&center_id="+$(".sel_center_class").val()+"&user_id=None"});
            $("#adminId").children('span').text('Remove');
            if(removed_center_admin_value == "")
                center_admin_value = $admin.val();
            else
                center_admin_value = removed_center_admin_value;
            if(resp =="Both-added"){
            }
        }
        else if(resp == "removed" || resp =="Both-removed"){
            $center.addClass("no-admin");
            evd.show_msg("Center admin for "+ $center_text + " is removed");
            $admin.val('');
            $(".sel_admin_class").val('');
            $("#adminId").css('display','none');
            center_admin_value = "";
        }
        if(resp == "Assistant-added"){
            $assistant.removeClass("no-assigned");
            evd.show_msg($center_text +" is assigned succesfully to "+ $assistant_text +" as Assistant");
            $("#assignId").css('display','block');
            $("#assignId").attr({"href": "/assign_center?flag=Assistant&center_id="+$(".sel_center_class").val()+"&assistant_id=None"});
            $("#assignId").children('span').text('Remove');
        }else if(resp == "Assistant-removed"){
            $assistant.addClass("no-assigned");
            evd.show_msg("Center Assistant for "+ $center_text + " is Removed");
            $assistant.val('');
            $(".sel_assistant_class").val('');
            $("#assignId").css('display','none');
        }
        if(resp == "FieldCoordinator-added"){
            $field_coordinatator.removeClass("no-assigned");
            evd.show_msg($center_text +" is assigned succesfully to "+ $field_coordinatator_text +" as FieldCoordinator");
            $("#fcId").css('display','block');
            $("#fcId").attr({"href": "/assign_center?flag=FieldCoordinator&center_id="+$(".sel_center_class").val()+"&fieldCoordinator_id=None"});
            $("#fcId").children('span').text('Remove');
        }else if(resp == "FieldCoordinator-removed"){
            $field_coordinatator.addClass("no-assigned");
            evd.show_msg("Center FieldCoordinator for "+ $center_text + " is Removed");
            $field_coordinatator.val('');
            $(".sel_fcd_class").val('');
            $("#fcId").css('display','none');
        }
         if(resp == "DeliveryCoordinator-added"){
            $delivery_coordinator.removeClass("no-assigned");
            evd.show_msg($center_text +" is assigned succesfully to "+ $delivery_coordinator_text +" as DeliveryCoordinator");
			$("#dcId").css('display','block');
            $("#dcId").attr({"href": "/assign_center?flag=DeliveryCoordinator&center_id="+$(".sel_center_class").val()+"&deliveryCoordinator_id=None"});
            $("#dcId").children('span').text('Remove');
        }else if(resp == "DeliveryCoordinator-removed"){
            $delivery_coordinator.addClass("no-assigned");
            evd.show_msg("Center DeliveryCoordinator for "+ $center_text + " is Removed");
            $delivery_coordinator.val('');
            $(".sel_dc_class").val('');
            $("#dcId").css('display','none');
        }
        if(resp == "PartnerAdmin-added"){
            $partner.removeClass("no-assigned");
            evd.show_msg($center_text +" is assigned succesfully to "+ $partner_text +" as Partner Admin");
			$("#partnerId").css('display','block');
            $("#partnerId").attr({"href": "/assign_center?flag=Partner&center_id="+$(".sel_center_class").val()+"&partner_id=None"});
            $("#partnerId").children('span').text('Remove');
        }else if(resp == "Partner-removed"){
            $partner.addClass("no-assigned");
            evd.show_msg("Center Partner for "+ $center_text + " is Removed");
            $partner.val('');
            $(".sel_partner_class").val('');
            $("#partnerId").css('display','none');
        }
        if(resp == "orgPartnerAdmin-added"){
            $orgpartner.removeClass("no-assigned");
            evd.show_msg($center_text +" is assigned succesfully to "+ $orgpartner_text +" as Org Partner Admin");
			$("#orgpartnerId").css('display','block');
            $("#orgpartnerId").attr({"href": "/assign_center?flag=OrgPartner&center_id="+$(".sel_center_class").val()+"&orgpartner_id=None"});
            $("#orgpartnerId").children('span').text('Remove');
        }else if(resp == "orgPartner-removed"){
            $orgpartner.addClass("no-assigned");
            evd.show_msg("Center Org Partner for "+ $center_text + " is Removed");
            $orgpartner.val('');
            $(".sel_orgpartner_class").val('');
            $("#orgpartnerId").css('display','none');
        }
    }
    window.evd.pre_students_save = function(){
                    var strengths = "",
                        weakness = "",
                        observation = "",
                        students_len = $("#mystudents form#students-form").find("input.strengths").length;
                    $("#mystudents form#students-form").find("input.strengths").each(function(index, val){
                        strengths += $(this).val() + (index < students_len-1 ? ";" : "");
                    });
                    $("#mystudents form#students-form").find("input.weakness").each(function(index, val){
                        weakness += $(this).val() + (index < students_len-1 ? ";" : "");
                    });
                    $("##mystudents form#students-form").find("input.observation").each(function(index, val){
                        observation += $(this).val() + (index < students_len-1 ? ";" : "");
                    });
                    $("#mystudents form#students-form input[name='strengths']").val(strengths);
                    $("#mystudents form#students-form input[name='weakness']").val(weakness);
                    $("#mystudents form#students-form input[name='observation']").val(observation);
                }
                window.evd.after_students_save = function(){
                    $("#mystudents").modal("hide");
                    evd.show_msg("Modified students successfully");
                }
    evd.pre_stu_filter = function(){
                     $("#mystudents p.title").remove();
                     $("#mystudents p.no-students").remove();
                     $("#mystudents table").remove();
                     $("#mystudents").find("a[rel='submit']").hide();
                     $("#mystudents").append('<img style="display:block;margin:10px auto" src="/static/images/loader.gif" alt="spinner" />');
                }
                evd.after_stu_filter = function(resp){
                    var len = resp.length;
                    $("#mystudents img").remove();
                    if(len != 0) {
                        var students = resp;
                        $("<p class='title' style='padding:10px 0px 0px 10px;'>Students for the selected offering are:</p>").insertAfter($("#mystudents .select-box"));
                        var student_html = '<table class="current_session_table">'+
                                                '<thead>'+
                                                    '<tr>'+
                                                        '<th style="width:150px">Name</th>'+
                                                        '<th>Strengths</th>'+
                                                        '<th>Weakness</th>'+
                                                        '<th>Observation</th>'+
                                                    '<tr>'+
                                                '</thead>'+
                                                '<tbody>';
                        var ids = "";
                        for(var index in students){
                            student = students[index];
                            ids += student.id + (index < students.length-1 ? ";" : "");
                            student_html += '<tr><td><div class="controls text"><p>' + student.name + '</p></div></td>'+
                                                '<td><div class="controls text"><input type="text" class="strengths" value="' + student.strengths + '" /></div></td>'+
                                                '<td><div class="controls text"><input type="text" class="weakness"  value="' + student.weakness + '"/></div></td>'+
                                                '<td><div class="controls text"><input type="text" class="observation"  value="' + student.observation + '"/></div></td></tr>';
                        }
                        student_html += "</tbody></table>";
                        $("#mystudents form#students-form").append(student_html);
                        $("#mystudents form#students-form input[name='student_ids']").val(ids);
                        $("#mystudents").find("a[rel='submit']").show();
                    }
else {
                        $("<p style='padding:10px 0px 0px 10px;' class='no-students'>The selected offering has no students assigned</p>").insertAfter($("#mystudents .select-box"));
                    }
                }

{% endblock %}

{% block head_styles %}
    {{ block.super }}
    <link rel='stylesheet' type='text/css' href='/static/css/calendar/fullcalendar.1.5.3.min.css'/>
    <link rel="stylesheet" type="text/css" href="/static/css/calendar/theme.css" />
    <link rel="stylesheet" type="text/css" href="/static/css/admindash.css" />
    <link rel="stylesheet" href="/static/css/jquery-ui.css"/>

    {% if is_delivery %}
    <style>
        .contributions{
            display : none !important;
        }
        .copyhover{
            cursor:pointer;
            color:green;
        }
    </style>
    {% endif %}
<style>
  .inner{
     width: 1040px;
   }
   .ui-autocomplete { 
   	 overflow-y: auto; 
   	 max-height:400px;
   } 
   .ui-autocomplete-loading { 
   	 background:url('/static/img/facebook_loading.gif') no-repeat right center ;
   }


   @media only screen and (max-width: 480px) and (min-width: 0px)  {
   .cont-align {
       <!--position: absolute !important;-->
    width: 93% !important;
    overflow-x: visible !important;
    }
#calendar {
    width: 108% !important;
    font-size: 10px;
    float: left;
    background: #f5f5f5;
    border: 1px solid #BDBDBD;
    margin-top: 27%;
    margin-left: -4%;
}

    .page-align{
    margin-right: 10%;
    }

     .wid-align{
     width: 104% !important;
     margin-left: -2%;
     }

   }
     @media only screen and (max-width: 480px) and (min-width: 380px)  {
   #calendar {
    width: 87% !important;
    font-size: 10px;
    float: left;
    background: #f5f5f5;
    border: 1px solid #BDBDBD;
    margin-top: 19%;
    margin-left: 6%;
}
     }

    @media only screen and (max-width: 768px) and (min-width: 480px)  {
    .cont-align {
       <!--position: absolute !important;-->
    width: 93% !important;
    overflow-x: visible !important;
    }

    .page-align{
    margin-right: 10%;
    }

     .wid-align{
     width: 104% !important;
     margin-left: -2%;
     }


    #calendar {
    width: 68% !important;
    font-size: 10px;
    float: left;
    background: #f5f5f5;
    border: 1px solid #BDBDBD;
    margin-top: 20%;
    margin-left: 15%;
    }
    }

    @media only screen and (max-width: 1024px) and (min-width: 768px)  {
    #calendar {
    width: 49% !important;
    font-size: 10px;
    float: left;
    background: #f5f5f5;
    border: 1px solid #BDBDBD;
    margin-left: 25%;
    }

    .wid-align{
     width: 104% !important;
     }

     .container {
    width: 100%;
    }

    }

    label {
        font-family: sans-serif !important;
    }
    #pageloader
{
  /* background: rgba( 255, 255, 255, 0.8 ); */
  display: none;
  height: 100%;
  position: fixed;
  width: 100%;
  z-index: 9999;
}

#pageloader img
{
  left: 30%; 
  /* margin-left: -32px; */
  /* margin-top: -32px; */
  position: absolute;
  /* top: 50%; */
}
   
</style>

<style>
    .ec-checkbox.check-lg .ec-checkbox__control {
        width: 28px;
        height: 28px;
    }
    .ec-checkbox__control {
        width: 24px;
        height: 24px;
        border: 1px solid #ccc;
        position: relative;
        margin-right: 10px;
        border-radius: 2px;
        -webkit-transition: .3s;
        -o-transition: .3s;
        transition: .3s;
        -webkit-box-flex: 0;
        -ms-flex: 0 0 auto;
        flex: 0 0 auto;
    }
</style>
{% endblock %}

{% block body_container %}
<div id="pageloader">
    <img src="http://cdnjs.cloudflare.com/ajax/libs/semantic-ui/0.16.1/images/loader-large.gif" alt="processing..." />
 </div>
            <div class="container">
                <div class="dashboard-notifications-container wid-align" style="width:650px;float:left;padding-right:10px">
                    




                    {% if user.is_superuser  %}
                    <div class="col-sm-12 col-md-12 note-box noteWidth cont-align" >
                        {% if messages %}
                        <div class="alert alert-success" id="success_alert" role="alert">
                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                            {% for messages in messages %}
                            {{messages}}
                            {% endfor %}
                          </div>
                        {% endif %}
                        <h3>Assign Role for User</h3>
                          
                               <br>
                               &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <div class="row">
                                    <form method="post" action="/partner/user_save_roles/" id="id_assign_role_to_user">
                                        <div class="col-sm-12 col-md-12 col-lg-12">
                                            <div class="col-sm-6 col-md-6 col-lg-6">
                                                <label for="id_search_user" class="myLabel">User</label>
                                                <input id="id_search_user" class="myInput form-control" type="text" name="search_user" value="" />
                    
                                                <input type="hidden" class="sel_user_list_val" name="selected_user" type="text" value="" data-language="">
                                            </div>
                                            {% csrf_token %}
                                            <div class="col-sm-6 col-md-6 col-lg-6">
                                                {% for role in assign_roles %}
                                                    <div>
                                                        <div class='row'>
                                                            <p class='role_ele'>
                                                                <input type="checkbox" id="{{ role.name|removespace }}" name='roles' value={{ role.id }} {% if role.id in pref_roles %} checked {% endif %} />
                                                                <label for="{{ role.name|removespace }}" class='myevd_label' style="font-size: 13px !important; font-family: 'sans-serif' !important; padding-left: 40px  !important">{{ role.name }}</label>
                                                            </p>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-12 col-lg-12">
                                            <!-- <div class="col-md-offset-5 col-sm-offset-5 col-sm-4 col-md-4"> -->
                                                <button type="submit" class="btn btn-md btn-success pull-right" name="assign_role_to_user" id="submit_assign_role_to_user" disabled="disabled" style="margin-bottom:16px;" >Assign</button>
                                            <!-- </div> -->
                                        </div>
                                    </form>
                                </div>
                    
                    </div>
                    {% endif %}
                    {% if user.is_superuser  %}
                    <div class="col-sm-12 col-md-12 note-box noteWidth cont-align" >
                        <h3>Assign PAM for Partner</h3>
                          
                               <br>
                               &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <div style="display:block;">
                                    <div class="col-md-1">
                                    <label>Partner:</label>
                                    </div>
                                    <div class="col-md-3 page-align">
                                        <input class="form-control" autocomplete="on" id="partner_data"
								placeholder="Search Partner"
								onclick="getExternalRolePartner(partner_data);" value="" style="width: 172px;">

                                    </div>
                                    <div class="col-md-1"></div>
                                    <div class="col-md-2" style="padding:0px;width: 125px;">
                                        <label>Name:</label>
                                    </div>

                                    <div class="col-md-3 page-align">
                                       <input class="form-control sel_partnername_class_val" type="text" value="" style="width: 172px;" readonly />
                                    </div>
                                    <div class="col-md-5"></div>
                                    <div class="col-md-2" style="padding:0px;width: 125px;">
                                        <label>Organisation Name:</label>
                                    </div>
                                    <div class="col-md-3 page-align">
                                        <input class="form-control  sel_orgname_class_val" type="text" value="" style="width: 172px;" readonly />
                                    </div>
                                    <div class="col-md-5"></div>
                                    <div class="col-md-2" style="padding:0px;width: 125px;">
                                        <label>Type:</label>
                                    </div>
                                    <div class="col-md-3 page-align">
                                        <select class="form-control  sel_typename_class_val" id ='partner_type' type="text" value="" style="width: 172px;" onchange="myFunction()" >
                                            
                                        </select>
                                    </div>
                                    <div class="col-md-4 page-align" style="margin-top: 15px;">
                                        <label>Partner Account Manager:</label>
                                    </div>
                                    <div class="col-md-4 page-align">
                                        <input id="pam_id"  class="form-control sel_pamname_class_val" placeholder="Search Partner" title="Search Partner" onclick="getpamuser(pam_id)" style="width: 172px; margin-top: 10px;"/>
                                    </div>
                                    <div class="col-md-2 page-align" >
                                        <label id="confirm_reject" style="cursor: pointer; margin-top: 20px;" onclick="confirm_reject_handler(this.innerHTML);"></label>
                                    </div>
                              
                     </div>
                     
                    </div>
                    {% endif %}
                    <div class="col-sm-12 col-md-12 note-box noteWidth cont-align" >
                    <h3>Provision User Roles</h3>
       				{% if user.is_superuser or is_partner %}
       					<br>
	       				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	       				<label class="errLabel" style="color:red;display:none;">Please select center</label>
                    	<div style="display:block;">
	                        <div class="col-md-1">
	                        	<label>Center:</label>
	                        </div>
	                    	<div class="col-md-3 page-align">
	                    		<input id="sel_center_id" class="form-control" placeholder="Search Center" title="Search Center" onkeyup="hideErrorLabel();" />
	                    		<input type="hidden" class="make-admin assign-center sel_center_class" type="text" value="" data-language="">
	                    	</div>
	                    	
	                     	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Admin:</label>
	                     	</div>
	                     	<div class="col-md-4 page-align">
		                    	<input class="form-control sel_admin_class" type="text" value="" placeholder="Search Admin" title="Search Admin" onkeyup="checkCenter(this,'adminId')"/>
		                    	<input type="hidden" value="" class="make-admin assign-admin sel_admin_class_val" type="text" value="" data-related="" data-language="">
	                     	</div>
	                     	<div class="col-md-1" align="left">
	                     		<a href="#assign" id="adminId" rel="ajax-link" callback="assign_center" style="padding-top:10px;display:none">
		                    		<span class="ajax-button-label" data-loading="processing">confirm</span>
		                    	</a>
	                     	</div>
	                     	<div class="col-md-4"></div>
	                     	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Assistant:</label>
	                     	</div>
	                     	<div class="col-md-4 page-align">
		                    	<input class="form-control sel_assistant_class" type="text" value="" placeholder="Search Assistant" title="Search Assistant" onkeyup="checkCenter(this,'assignId')" /> 
		                		<input type="hidden" class="make-admin assign-assistant sel_assistant_class_val" value="" data-related="" data-language="" >
		                	</div>
		                	<div class="col-md-1" align="left">
		                	<a href="#assign" id="assignId" rel="ajax-link" callback="assign_center" style="display:none;padding-top:10px">
		                         	<span class="ajax-button-label" data-loading="processing">confirm</span>
		                        </a>
		                	</div>
                            {% if user.is_superuser %}
                                <div class="col-md-4"></div>
                                <div class="col-md-2" style="padding:0px;width: 125px;">
                                <label>Partner Admin:</label>
                                </div>
                                <div class="col-md-4 page-align">
                                    <input class="form-control sel_partner_class" type="text" value="" placeholder="Search Partner Admin" title="Search Partner Admin" onkeyup="checkCenter(this,'partnerId')" />
                                    <input type="hidden" class="make-admin assign-partner sel_partner_class_val" value="" data-related="">
                                </div>
                                <div class="col-md-1" align="left">
                                <a href="#assign" id="partnerId" rel="ajax-link" callback="assign_center" style="display:none;">
                                    <span class="ajax-button-label" data-loading="processing">confirm</span>
                                </a>
                                </div>

                                <div class="col-md-4"></div>
                                <div class="col-md-2" style="padding:0px;width: 125px;">
                                <label>OrgPartner Admin:</label>
                                </div>
                                <div class="col-md-4 page-align">
                                    <input class="form-control sel_orgpartner_class" type="text" value="" placeholder="Search Org Partner Admin" title="Search Org Partner Admin" onkeyup="checkCenter(this,'orgpartnerId')" />
                                    <input type="hidden" class="make-admin assign-orgpartner sel_orgpartner_class_val" value="" data-related="">
                                </div>
                                <div class="col-md-1" align="left">
                                <a href="#assign" id="orgpartnerId" rel="ajax-link" callback="assign_center" style="display:none;">
                                    <span class="ajax-button-label" data-loading="processing">confirm</span>
                                </a>
                                </div>
	                     	{% endif %}
	                     	<div class="col-md-4"></div>
	                     	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Field Coordinator:</label>
	                     	</div>
	                     	<div class="col-md-4 page-align">
	                     		<input class="form-control sel_fcd_class" type="text" value="" placeholder="Search Field Coordinator" title="Search Field Coordinator" onkeyup="checkCenter(this,'fcId')"/>
	                     		<input type="hidden" class="make-admin assign-field sel_fcd_class_val" value="" data-related="" data-language="">
	                     	</div>
	                     	<div class="col-md-1" align="left">
	                     		<a href="#assign" id="fcId" rel="ajax-link" callback="assign_center" style="display:none;">
			                    	<span class="ajax-button-label" data-loading="processing">confirm</span>
			               		</a>
	                     	</div>
	                     	
	                     	<div class="col-md-4"></div>
	                     	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Delivery Coordinator (DSM):</label>
	                     	</div>
	                     	<div class="col-md-4 page-align">
	                     		<input class="form-control sel_dc_class" type="text" value="" placeholder="Search Delivery Coordinator" title="Search Delivery Coordinator" onkeyup="checkCenter(this,'dcId')"/>
	                     		<input type="hidden" class="make-admin assign-delivery sel_dc_class_val" data-related="" data-language="" value="">
	                     	</div>
	                     	<div class="col-md-1" align="left">
	                     		 <a href="#assign" id="dcId" rel="ajax-link" callback="assign_center" style="display:none;">
		                         	<span class="ajax-button-label" data-loading="processing">confirm</span>
		                    	</a>
	                     	</div>  
	             </div>
             {% else %}
             <br>
             			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	       				<label class="errLabel" style="color:red;display:none;">Please select center</label>
                    	<div style="display:block;">
	                        <div class="col-md-1">
	                        	<label>Center:</label>
	                        </div>
	                    	<div class="col-md-3">	
	                    		<input id="sel_center_id" class="form-control" placeholder="Search Center" title="Search Center" onkeyup="hideErrorLabel();" />
	                    		<input type="hidden" class="make-admin assign-center sel_center_class" type="text" value="" data-language="">
	                    	</div>
	             {% if is_delivery_coordinator %}
		             		<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Admin:</label>
	                     	</div>
	                     	<div class="col-md-4">
		                    	<input class="form-control sel_admin_class" type="text" value="" placeholder="Search Admin" title="Search Admin" onkeyup="checkCenter(this)"/>
		                    	<input type="hidden" value="" class="make-admin assign-admin sel_admin_class_val" type="text" value="" data-related="" data-language="">
	                     	</div>
	                     	<div class="col-md-1" align="left">
	                     		<a href="#assign" id="adminId" rel="ajax-link" callback="assign_center" style="padding-top:10px;display:none">
		                    		<span class="ajax-button-label" data-loading="processing">confirm</span>
		                    	</a>
	                     	</div>
	                     	
	                     	
	                     	<div class="col-md-4"></div>
	                     	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Field Coordinator:</label>
	                     	</div>
	                     	<div class="col-md-4">
	                     		<input class="form-control sel_fcd_class" type="text" value="" placeholder="Search Field Coordinator" title="Search Field Coordinator" onkeyup="checkCenter(this,'fcId')"/>
	                     		<input type="hidden" class="make-admin assign-field sel_fcd_class_val" value="" data-related="" data-language="">
	                     	</div>
	                     	<div class="col-md-1" align="left">
	                     		<a href="#assign" id="fcId" rel="ajax-link" callback="assign_center" style="display:none;">
			                    	<span class="ajax-button-label" data-loading="processing">confirm</span>
			               		</a>
	                     	</div>




		         {% elif is_field_coordinator %}
	                     	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Assistant:</label>
	                     	</div>
	                     	<div class="col-md-4">
		                    	<input class="form-control sel_assistant_class" type="text" value="" placeholder="Search Assistant" title="Search Assistant" onkeyup="checkCenter(this)" /> 
		                		<input type="hidden" class="make-admin assign-assistant sel_assistant_class_val" value="" data-related="" data-language="" >
		                	</div>
		                	<div class="col-md-1" align="left">
		                	<a href="#assign" id="assignId" rel="ajax-link" callback="assign_center" style="display:none;padding-top:10px">
		                         	<span class="ajax-button-label" data-loading="processing">confirm</span>
		                        </a>
		                	</div>
		                	
		                	
		              {% elif is_partner %}
		                	
		                	
	                     	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Field Coordinator:</label>
	                     	</div>
	                     	<div class="col-md-4">
	                     		<input class="form-control sel_fcd_class" type="text" value="" placeholder="Search Field Coordinator" title="Search Field Coordinator" onkeyup="checkCenter(this,'fcId')"/>
	                     		<input type="hidden" class="make-admin assign-field sel_fcd_class_val" value="" data-related="" data-language="">
	                     	</div>
	                     	<div class="col-md-1" align="left">
	                     		<a href="#assign" id="fcId" rel="ajax-link" callback="assign_center" style="display:none;">
			                    	<span class="ajax-button-label" data-loading="processing">confirm</span>
			               		</a>
	                     	</div>

		                	
		                	<div class="col-md-4"></div>
		                	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Assistant:</label>
	                     	</div>
	                     	<div class="col-md-4">
		                    	<input class="form-control sel_assistant_class" type="text" value="" placeholder="Search Assistant" title="Search Assistant" onkeyup="checkCenter(this)" /> 
		                		<input type="hidden" class="make-admin assign-assistant sel_assistant_class_val" value="" data-related="" data-language="" >
		                	</div>
		                	<div class="col-md-1" align="left">
		                	<a href="#assign" id="assignId" rel="ajax-link" callback="assign_center" style="display:none;padding-top:10px">
		                         	<span class="ajax-button-label" data-loading="processing">confirm</span>
		                        </a>
		                	</div>
		                	
		                	
		         {% else %}
		            		
	                     	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Field Coordinator:</label>
	                     	</div>
	                     	<div class="col-md-4">
	                     		<input class="form-control sel_fcd_class" type="text" value="" placeholder="Search Field Coordinator" title="Search Field Coordinator" onkeyup="checkCenter(this,'fcId')"/>
	                     		<input type="hidden" class="make-admin assign-field sel_fcd_class_val" value="" data-related="" data-language="">
	                     	</div>
	                     	<div class="col-md-1" align="left">
	                     		<a href="#assign" id="fcId" rel="ajax-link" callback="assign_center" style="display:none;">
			                    	<span class="ajax-button-label" data-loading="processing">confirm</span>
			               		</a>
	                     	</div>
	                     	
                   			<div class="col-md-4"></div>
	                     	<div class="col-md-2" style="padding:0px;width: 125px;">
	                     		<label>Assistant:</label>
	                     	</div>
	                     	<div class="col-md-4">
		                    	<input class="form-control sel_assistant_class" type="text" value="" placeholder="Search Assistant" title="Search Assistant" onkeyup="checkCenter(this)" /> 
		                		<input type="hidden" class="make-admin assign-assistant sel_assistant_class_val" value="" data-related="" data-language="" >
		                	</div>
		                	<div class="col-md-1" align="left">
		                	<a href="#assign" id="assignId" rel="ajax-link" callback="assign_center" style="display:none;padding-top:10px">
		                         	<span class="ajax-button-label" data-loading="processing">confirm</span>
		                        </a>
		                	</div>
		                	
	             {% endif %}
	             <!-- <div class="col-md-1" align="left">
	             	<a href="#assign" id="confirmId" rel="ajax-link" callback="assign_center" style="display:block;">
	             		<span class="ajax-button-label" data-loading="processing">confirm</span>
	             	</a>
	             </div> -->
	        </div>
   {% endif %}
       </div>
       <div>
       <span><a href="/v2/demand/stats/" class="btn btn-primary" style="background-color: #43b335;">Click Here</a>To share your filtered demand URL</span>
   </div>
   {% if org_partner %}
    <div class="col-sm-12 col-md-12 col-lg-12" style="border: 1px solid #bdbdbd;background: #f9f9f9;">
        <fieldset>
            <lagend><h4><b>User Role Update</b></h4></lagend>
            <hr/>
            <div class="row">
                <form method="post" action="/partner/user_save_roles/" id="id_assign_role_to_user">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <div class="col-sm-6 col-md-6 col-lg-6">
                            <label for="id_search_user" class="myLabel">User</label>
                            <input id="id_search_user" class="myInput" type="text" name="search_user" value="" />
                            partner_assign_user_roles
                            <input type="hidden" class="sel_user_list_val" name="selected_user" type="text" value="" data-language="">
                        </div>
                        {% csrf_token %}
                        <div class="col-sm-6 col-md-6 col-lg-6">
                            {% for role in roles %}
                                <div>
                                    {% if role.type != 'Internal' %}
                                       <div class='row'>
                                           <p class='role_ele'>
                                                <input type="checkbox" id="{{ role.name|removespace }}" name='roles' value={{ role.id }} {% if role.id = 6 or role.id = 7 %}disabled{% endif %}{% if role.id in pref_roles %} checked {% endif %} />
                                                <label for="{{ role.name|removespace }}" class='myevd_label'  {% if role.id = 8 or role.id = 9 or role.id = 10 %}style="visibility:hidden;"{% endif %}   >{{ role.name }}</label>
                                           </p>
                                       </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <div class="col-md-offset-5 col-sm-offset-5 col-sm-4 col-md-4">
                            <button type="submit" class="btn btn-success" name="assign_role_to_user" id="submit_assign_role_to_user" disabled="disabled" style="margin-bottom:16px;" >Update</button>
                        </div>
                    </div>
                </form>
            </div>
        </fieldset>

    </div>


     <div class="col-sm-12 col-md-12 col-lg-12" style="margin-top:10px;border: 1px solid #bdbdbd;background: #f9f9f9;">
    <fieldset>
        <lagend><h4><b>Organization Details</b></h4></lagend>
        <hr/>
        <div class="row">
            <form id="id_org_details" method="post" action="/partner/partner_adminpage/">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_org_name" class="myLabel">Name of Organization</label>
                        <input id="id_org_name" class="myInput" type="text" name="org_name" value="{{org_partner.name_of_organization}}" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_address" class="myLabel">Address</label>
                        <input id="id_address" type="text" name="address" value="{{org_partner.address}}" class="myInput" />
                    </div>
                </div>
                {% csrf_token %}
                {% if is_partner_delivery or is_partner_volunteer %}
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_website_address" class="myLabel">Website Address</label>
                        <input id="id_website_address" type="text" name="website_address" value="{{org_partner.delivery_partnerobj.all.0.website_address}}" class="myInput" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_office_phone" class="myLabel">Office Phone</label>
                        <input id="id_office_phone" type="text" name="office_phone" value="{{org_partner.delivery_partnerobj.all.0.office_phone}}" class="myInput" />
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_email" class="myLabel">Email</label>
                        <input id="id_email" type="text" name="email" value="{{org_partner.email}}" class="myInput" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_org_type" class="myLabel">Type of Organization</label>
                        <select id="id_org_type" name="org_type" class="myInput" style="width:80%">
                            {% if is_partner_volunteer %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "Corporate" %}<option value="Corporate" selected="selected">Corporate</option> {% else %} <option value="Corporate">Corporate</option> {% endif %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "AcademicInstitution" %}<option value="Academic Institution" selected="selected">Academic Institution</option> {% else %} <option value="Academic Institution">Academic Institution</option> {% endif %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "VolunteeringCommunity" %}<option value="Volunteering Community" selected="selected">Volunteering Community</option> {% else %} <option value="Volunteering Community">Volunteering Community</option> {% endif %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "RegionalCommunity" %}<option value="Regional Community" selected="selected">Regional Community</option> {% else %} <option value="Regional Community">Regional Community</option> {% endif %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "LinguisticCommunity" %}<option value="Linguistic Community" selected="selected">Linguistic Community</option> {% else %}<option value="Linguistic Community">{% endif %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "SpecialInterestGroup" %}<option value="Special Interest Group" selected="selected">Special Interest Group</option>{% else %}<option value="Special Interest Group">Special Interest Group</option>{% endif %}
                            {% elif is_partner_delivery %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "Trust" %} <option value="Trust"  selected="selected">Trust</option> {% else %} <option value="Trust">Trust</option> {% endif %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "Society" %} <option value="Society" selected="selected">Society</option> {% else %} <option value="Society">Society</option> {% endif %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "Section8" %} <option value="Section 8" selected="selected">Section 8</option> {% else %} <option value="Section 8">Section 8</option> {% endif %}
                            {% endif %}
                                {% if org_partner.delivery_partnerobj.all.0.type_of_org|cut:" " == "Others" %}<option value="Others" selected="selected">Others</option> {% else %} <option value="Others">Others</option> {% endif %}
                        </select>
                    </div>
                </div>

                {% if is_partner_delivery %}
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_date_of_reg" class="myLabel">Date of Registration</label>
                        <input id="id_date_of_reg" type="text" name="date_of_reg" value="{{org_partner.delivery_partnerobj.all.0.date_of_reg}}" class="myInput" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_org_reg_place" class="myLabel">Place of Registration</label>
                        <input id="id_org_reg_place" type="text" name="org_reg_place" value="{{org_partner.delivery_partnerobj.all.0.place_of_reg}}" class="myInput" />
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_reg_number" class="myLabel">Registration Number</label>
                        <input id="id_reg_number" type="text" name="reg_number" value="{{org_partner.delivery_partnerobj.all.0.reg_number}}" class="myInput" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_number" class="myLabel">12A/80G Number</label>
                        <input id="id_number" type="text" name="number" value="{{org_partner.delivery_partnerobj.all.0.number}}" class="myInput" />
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_fcra_reg_number" class="myLabel">FCRA Regn. Number</label>
                        <input id="id_fcra_reg_number" type="text" name="fcra_reg_number" value="{{org_partner.delivery_partnerobj.all.0.fcra_reg_number}}" class="myInput" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_fcra_acc_number" class="myLabel">FCRA Acc Number</label>
                        <input id="id_fcra_acc_number" type="text" name="fcra_acc_number" value="{{org_partner.delivery_partnerobj.all.0.fcra_acc_number}}" class="myInput" />
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_bank_name" class="myLabel">Bank Name</label>
                        <input id="id_bank_name" type="text" name="bank_name" value="{{org_partner.delivery_partnerobj.all.0.bank_name}}" class="myInput" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_ifsc_code" class="myLabel">IFSC Code</label>
                        <input id="id_ifsc_code" type="text" name="ifsc_code" value="{{org_partner.delivery_partnerobj.all.0.ifsc_code}}" class="myInput" />
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_acc_name" class="myLabel">Account Holder Name</label>
                        <input id="id_acc_name" type="text" name="acc_name" value="{{org_partner.delivery_partnerobj.all.0.acc_holder_name}}" class="myInput" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_acc_number" class="myLabel">Account Number</label>
                        <input id="id_acc_number" type="text" name="acc_number" value="{{org_partner.delivery_partnerobj.all.0.acc_number}}" class="myInput" />
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-sm-6 col-md-6 col-lg-6">
                        <label for="id_acc_type" class="myLabel">Type Of Account</label>
                        <input id="id_acc_type" type="text" name="acc_type" value="{{org_partner.delivery_partnerobj.all.0.type_of_acc}}" class="myInput" />
                    </div>
                    <div class="col-sm-6 col-md-6 col-lg-6">
                    </div>
                </div>
                {% endif %}
                {% endif %}
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="col-md-offset-5 col-sm-offset-5 col-sm-4 col-md-4">
                        <button type="submit" class="btn btn-success" name="submit_ord_details" id="submit_ord_details" style="margin-bottom:16px;" >Update</button>
                    </div>
                </div>
            </form>
        </div>
    </fieldset>
</div>
  <div class="col-sm-12 col-md-12 col-lg-12" style="border: 1px solid #bdbdbd;background: #f9f9f9;padding: 20px;margin-top: 10px;">
      <fieldset>
          <lagend><h4><b>Volunteer Resource Mobilization</b></h4></lagend>
          <div class="col-sm-12 col-md-12 col-lg-12">
              <p><button class="btn btn-sm" onclick='$("#id_vol_resource_mobil").show()' style="margin-bottom:7px" >Click here</button> to get URL</p>
              <div id="id_vol_resource_mobil" class="col-sm-12 col-md-12 col-lg-12" style="border: 1px solid #a0b3b0;border-radius: 5px;">
                  <p style="padding: 5px 16px 0px 0px;text-align:center;"> <span id="id_url_text">https://www.evidyaloka.org/volunteer/p/{{org_partner.id}} </span><i class="fa fa-clipboard pull-right copyhover" onclick="copyurl()" title="Copy to Clipboard" aria-hidden="true"></i></p>
              </div>
          </div>
          <div class="alert alert-success col-sm-12 col-md-12 col-lg-12" id="success-alert" style="margin-top: 7px;">
              <strong>Success! </strong>
              Link is copied to the Clipboard...!!!
          </div>
      </fieldset>
  </div>
   {% endif %}
  </div>
	<div class="dashboard-calendar-container wid-align" style="width:370px;min-height:500px;float:left">
		<div id="calendar"></div>
	</div>
	<div id="teacher-modal" class="modal hide  wid-align" style="width:510px;">
		<a class="close" data-dismiss="modal" style="float:right;cursor:pointer;">X</a>
    		<img src="/static/images/loader.gif" alt="spinner" style="float:none;margin:20px auto;display:block;" />
	</div>
</div>
{% endblock %}

{% block bottom_scripts %}
    {{ block.super }}
    <script>
        $("#success_alert").fadeTo(2000, 500).slideUp(500, function(){
    $("#success_alert").slideUp(1000);
});
	function getExternalRolePartner(search_results){
                $(".sel_pamname_class_val").empty();
                $('.sel_typename_class_val').empty();
                $(search_results).autocomplete(
                {
                source : "/v2/ajax/getExternalRolePartner",
                minLength : 1,
                autoFocus : true,
                select : function(event, ui) {
				$(".sel_center_class").val(ui.item.id);
				$(".errLabel").hide();
                if (ui.item.id!==undefined){
                	$.ajax({
                    	url : '/v2/ajax/getPartnerUsers?partner_id=' + ui.item.id,
                        dataType : 'JSON',
                        success : function(data){
                            for (i=0;i<data.length;i++){
                                console.log("dddd",data[i]['pam_name'])
                                $(".sel_partnername_class_val").val(data[i]['name']);
                                $(".sel_orgname_class_val").val(data[i]['organistaion_name']);
                                var types= data[i]['type']
                                $.each(types, function (i, item) {
                                	$('.sel_typename_class_val').append($('<option>', { 
                                		value: item,
                                		text : item
                                	}));
                                });
                                $(".sel_pamname_class_val").val(data[i]['pam_name']);

                                console.log("sssss",document.getElementById("pam_id").value.length)
                                break
                            }

                            if ( $("#pam_id").val() != "") {
                                $("#pam_id").prop("readonly", true);
                                $("#confirm_reject").text("Remove");
                            } else {
                                $("#pam_id").prop("readonly", false);
                            }
                        }
                    });
                }
            },
            change: function(event, ui){
            	if (ui.item){
            		return;
            	}else{
            		$(this).val('');
            		$(".sel_center_class").val('');
            		emptyUsers();
            		hideCRButtons();
            		
            	}
            }
        });
    }
    function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
    var csrftoken = getCookie('csrftoken');
    function confirm_reject_handler(option_txt) {
        console.log("**** Clicked " + option_txt);
        if (option_txt === "Confirm") {
            $.post("/v2/confirm_pam/", {"partner_id":$("#partner_data").val(),'csrfmiddlewaretoken':csrftoken, "type_id":$("#partner_type").val(),"pam_id":$(".sel_pamname_class_val").val()}, function(resp){
                if (resp['status'] === "Success" ) {
                    $("#pam_id").prop("readonly", true);
                    $("#confirm_reject").text("Remove");
                    alert("PAM Assigned Successfully");
                    return true;
                }
            });
              
        } else {
            var choice = confirm("Are you sure you would like to remove PAM?");
            if (choice === true) {
                $.post("/v2/remove_pam/", {"partner_id":$("#partner_data").val(),'csrfmiddlewaretoken':csrftoken,"type_id":$("#partner_type").val()}, function(resp){
                    if (resp['status'] === "Success" ) {
                        $("#pam_id").prop("readonly", false);
                        $("#pam_id").val("");
                        $("#confirm_reject").text("");
                        alert("PAM Removed");
                        return true;
                    }
                });
            }
        }
    }


    function getpamuser(search_results){
                var partner_type = $("#partner_type").val(); 
                $(search_results).autocomplete(
                {
                source : "/v2/ajax/getExternalRolepam?partner_type_id=" + partner_type,
                minLength : 1,
                autoFocus : true,
                select : function(event, ui) {
				$(".sel_pamname_class_val").val(ui.item.id);confirm
				$(".errLabel").hide();
                if (ui.item.id != undefined) {
                    $("#confirm_reject").text("Confirm");
                }
               
                },
            change: function(event, ui){
            	if (ui.item){
            		return;
            	}else{
            		$(this).val('');
            		$(".sel_pamname_class_val").val('');
            		emptyUsers();
            		hideCRButtons();
            		
            	}
            }
        });
    }



function myFunction() {
                            $("#pam_id").prop("readonly", false);
                            $("#pam_id").val("");
                            $("#confirm_reject").text("");
                            var partner = $("#partner_data").val();
	                        var partner_type = $("#partner_type").val();
                            $.ajax({
                    	            url : '/v2/ajax/getPam?partner=' + partner+'&partner_type='+partner_type,
                                    dataType : 'JSON',
                                    success : function(data){
                                    for (i=0;i<data.length;i++){
                                    $(".sel_pamname_class_val").val(data[i]['pam_name']);
                                    
                                    console.log("dddd")
                                    break
  
                            }

                            if ( $("#pam_id").val() != "") {
                                $("#pam_id").prop("readonly", true);
                                $("#confirm_reject").text("Remove");
                            } else {
                                $("#pam_id").prop("readonly", false);
                            }
                            }
                            });
                            }


    </script>
    <script type='text/javascript' src='/static/js/calendar/fullcalendar.js'></script>
    <script type="text/javascript" src="/static/js/calendar/jquery-ui-1.8.17.custom.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.tmpl.min.js"></script>
    <script type="text/javascript" src="/static/js/admindash.js"></script>
    
    <script type="text/javascript" src="/static/js_new/jquery-ui.min.js"></script>
    <script>
        function copyurl() {
            var inp =document.createElement('input');
            document.body.appendChild(inp)
            var copyText = document.getElementById("id_url_text");
            inp.value = copyText.textContent
            inp.select();
            document.execCommand('copy',false);
            inp.remove();
            $("#success-alert").fadeTo(2000, 500).slideUp(500, function(){
                $("#success-alert").slideUp(1000);
            });
        }
    </script>
    <script>

    $(document).ready(function(){
        $("#id_assign_role_to_user").on("submit", function(){
    $("#pageloader").fadeIn();
  });
        $("#success-alert").hide();
        $("#id_vol_resource_mobil").hide()
    	getUsersByRole(".sel_admin_class", "2", "normal", "#adminId", "user_id", "Admin");
    	getUsersByRole(".sel_assistant_class", "6", "normal", "#assignId", "assistant_id", "Assistant");
    	getUsersByRole(".sel_partner_class", "2", "partner", "#partnerId", "partner_id", "Partner");
    	getUsersByRole(".sel_orgpartner_class", "4", "orgpartner", "#orgpartnerId", "orgpartner_id", "OrgPartner");
    	getUsersByRole(".sel_fcd_class", "11", "normal", "#fcId", "fieldCoordinator_id", "FieldCoordinator");
    	getUsersByRole(".sel_dc_class", "12", "normal", "#dcId", "deliveryCoordinator_id", "DeliveryCoordinator");
        callAutoComplete('sel_center_id');
        $("#confirm_reject").text("");
    });
    
    function hideErrorLabel(){
    	$(".errLabel").hide();
    } 
    
    function getUsersByRole(class_name, role_id, type, btnId, var_param, flag_type){
    	var ajax_url = '/v2/ajax/getSelUsers?role_id=' + role_id + '&type=' + type;
   		$(class_name).autocomplete({
        	source: function(request, response){
        		$.getJSON(ajax_url, { center_id: $(".sel_center_class").val(), term: $(class_name).val() }, response);
        	},
            minLength: 1,
            select: function(event, ui) {
            	hideCRButtons();
            	$(class_name + '_val').val(ui.item.id);

               	if ((ui.item.center_id).toString().indexOf($(".sel_center_class").val())>-1){
                       $(btnId).children('span').text('Confirm');
                       $(btnId).attr({"href": "/assign_center?flag="+flag_type+"&center_id="+$(".sel_center_class").val()+"&"+var_param+"="+$(class_name+'_val').val()+""});
                       $(btnId).show();
               	}else{
                       $(btnId).children('span').text('Confirm');
                       $(btnId).attr({"href": "/assign_center?flag="+flag_type+"&center_id="+$(".sel_center_class").val()+"&"+var_param+"="+$(class_name+'_val').val()+""});
                       $(btnId).show();
               	}
            	
	         },
	         change: function(event, ui){
	        	 if(ui.item){
	        		 return;
	        	 }else{
	        		 $(this).val('');
	        		 $(class_name + '_val').val('');
	        		 hideCRButtons();
	        	 }
	         }
         });
    }
    
    function checkCenter(value,Id) {
    	$(".errLabel").hide();
     	if($(".sel_center_class").val()=='' || $(".sel_center_class").val()==null || $(".sel_center_class").val()==undefined) {
    		$(".errLabel").show();
    		$(value).val('');
    		
    	}  
     	
     	if($(value).val()=='' || $(value).val() == null || $(value).val() == undefined) {
     		$("#"+Id).hide();
     	}else{
     		$("#"+Id).show();
     	}
     	
    }
    
    
   
    function clearInput(class_name) {
    	$("."+class_name).val('');
    }
    
    function hideCRButtons(){
    	if ($(".sel_admin_class_val").val()==null || $(".sel_admin_class_val").val()=='' || $(".sel_admin_class_val").val()==undefined){
    		$("#adminId").hide();
    	}if ($(".sel_assistant_class_val").val()==null || $(".sel_assistant_class_val").val()=='' || $(".sel_assistant_class_val").val()==undefined){
    		$("#assignId").hide();
    	}if ($(".sel_partner_class_val").val()==null || $(".sel_partner_class_val").val()=='' || $(".sel_partner_class_val").val()==undefined){
    		$("#partnerId").hide();
    	}if ($(".sel_orgpartner_class_val").val()==null || $(".sel_orgpartner_class_val").val()=='' || $(".sel_orgpartner_class_val").val()==undefined){
    		$("#orgpartnerId").hide();
    	}if ($(".sel_fcd_class_val").val()==null || $(".sel_fcd_class_val").val()=='' || $(".sel_fcd_class_val").val()==undefined){
    		$("#fcId").hide();
    	}if ($(".sel_dc_class_val").val()==null || $(".sel_dc_class_val").val()=='' || $(".sel_dc_class_val").val()==undefined){
    		$("#dcId").hide();
    	}
    }
    
    function emptyUsers(){
    	$(".sel_admin_class").val('');
    	$(".sel_admin_class_val").val('');
    	$(".sel_assistant_class").val('');
    	$(".sel_assistant_class_val").val('');
    	$(".sel_partner_class").val('');
    	$(".sel_partner_class_val").val('');
    	$(".sel_orgpartner_class").val('');
    	$(".sel_orgpartner_class_val").val('');
    	$(".sel_fcd_class").val('');
    	$(".sel_fcd_class_val").val('');
    	$(".sel_dc_class").val('');
    	$(".sel_dc_class_val").val('');
    }





    function callAutoComplete(id){
    	hideCRButtons();
        $("#"+id).autocomplete({
            source: "/v2/ajax/getSelCentersBaseOnUser",
            minLength: 1,
            select: function(event, ui){
				$(".sel_center_class").val(ui.item.id);
				$(".errLabel").hide();
                if (ui.item.id!==undefined){
                	$.ajax({
                    	url : '/v2/ajax/getCenterUsers?center_id=' + ui.item.id,
                        dataType : 'JSON',
                        success : function(data){
                        	$("#partnerId").hide();
                        	$("#orgpartnerId").hide();
                        	$("#assignId").hide();
                        	$("#adminId").hide();
                        	$("#fcId").hide();
                        	$("#dcId").hide();
                        	
                            if (data!=null && data!='' && data!==undefined){
                            	emptyUsers();
                                for (i=0;i<data.length;i++){
                                	if (data[i]['role']=='admin'){
                                       $(".sel_admin_class").val(data[i]['label']);
                                       $(".sel_admin_class_val").val(data[i]['value']);
                                       $("#adminId").children('span').text('Remove');
                                       $("#adminId").attr({"href": "/assign_center?flag=Admin&center_id="+$(".sel_center_class").val()+"&user_id=None"});
                                       $("#adminId").show();
                                    } else if (data[i]['role']=='assistant'){
                                       $(".sel_assistant_class").val(data[i]['label']);
                                       $(".sel_assistant_class_val").val(data[i]['value']);
                                       $("#assignId").children('span').text('Remove');
                                       $("#assignId").attr({"href": "/assign_center?flag=Assistant&center_id="+$(".sel_center_class").val()+"&assistant_id=None"});
                                       $("#assignId").show();
                                    }else if (data[i]['role']=='delivery_partner'){
                                    	$(".sel_partner_class").val(data[i]['label']);
                                    	$(".sel_partner_class_val").val(data[i]['value']);
                                    	$("#partnerId").children('span').text('Remove');
                                    	$("#partnerId").attr({"href": "/assign_center?flag=Partner&center_id="+$(".sel_center_class").val()+"&partner_id=None"});
                                        $("#partnerId").show();
                                    }else if (data[i]['role']=='organization_unit'){
                                    	$(".sel_orgpartner_class").val(data[i]['label']);
                                    	$(".sel_orgpartner_class_val").val(data[i]['value']);
                                    	$("#orgpartnerId").children('span').text('Remove');
                                    	$("#orgpartnerId").attr({"href": "/assign_center?flag=OrgPartner&center_id="+$(".sel_center_class").val()+"&orgpartner_id=None"});
                                        $("#orgpartnerId").show();
                                    }else if (data[i]['role']=='field_coordinator'){
                                       	$(".sel_fcd_class").val(data[i]['label']);
                                       	$(".sel_fcd_class_val").val(data[i]['value']);
                                       	$("#fcId").children('span').text('Remove');
                                   		$("#fcId").attr({"href": "/assign_center?flag=FieldCoordinator&center_id="+$(".sel_center_class").val()+"&fieldCoordinator_id=None"});
                                       	$("#fcId").show();
                                    }else if (data[i]['role']=='delivery_coordinator'){
                                       	$(".sel_dc_class").val(data[i]['label']);
                                       	$(".sel_dc_class_val").val(data[i]['value']);
                                       	$("#dcId").children('span').text('Remove');
                                  		$("#dcId").attr({"href": "/assign_center?flag=DeliveryCoordinator&center_id="+$(".sel_center_class").val()+"&deliveryCoordinator_id=None"});
                                     	$("#dcId").show();
                                    } 
                                    
                               }
                            }
                        }
                    });
                }
            },
            change: function(event, ui){
            	if (ui.item){
            		return;
            	}else{
            		$(this).val('');
            		$(".sel_center_class").val('');
            		emptyUsers();
            		hideCRButtons();
            		
            	}
            }
        });
    }



    var autocomplete_data = {
        source : "/partner/ajax/get_my_users",
        minLength : 3,
        autoFocus : true,
        select : function(event, ui) {
               $(this).val(ui.item.value);
               $('.sel_user_list_val').val(ui.item.id);
               var rolenames = "{{roles|getnames|safe}}";
               rolenames = rolenames.replace(/'/g, '"');
               var myroles = JSON.parse(rolenames)
               for(i=0; i<myroles.length;i++){
                    $('#'+myroles[i]).removeAttr('checked');
               }
               if(ui.item.roles){
                    var roles = ui.item.roles.split(',')
                    for(r=0; r<roles.length;r++) {
                        document.getElementById(roles[r].replace(/\s+/g,'').trim()).checked = true;
//$('#'+roles[r].replace(/\s+/g,'').trim()).attr('checked','checked');
                    }
                }
                $("#submit_assign_role_to_user").removeAttr('disabled');
         },
       change : function(event, ui) {
             if (ui.item) {
                    return;
             }
             else {
                $(this).val('');
                $('.sel_user_list_val').val('');
                var rolenames = "{{roles|getnames|safe}}";
                rolenames = rolenames.replace(/'/g, '"');
                var myroles = JSON.parse(rolenames)
                for(i=0; i<myroles.length;i++){
                   $('#'+myroles[i]).removeAttr('checked');
                }
                $("#submit_assign_role_to_user").attr('disabled','disabled');
             }
          }
    }

    $('#id_search_user').click(function(){

        $(this).autocomplete(autocomplete_data)
     });
   
    </script>

{% endblock %}
